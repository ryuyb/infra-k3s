---
# Velero Backup Storage Location - Cloudflare R2
#
# Prerequisites:
#   1. Create R2 bucket in Cloudflare dashboard
#   2. Create R2 API token with read/write access
#   3. Create credentials secret:
#      kubectl create secret generic velero-r2-credentials \
#        --namespace velero \
#        --from-literal=cloud="[default]
#      aws_access_key_id=$R2_ACCESS_KEY_ID
#      aws_secret_access_key=$R2_SECRET_ACCESS_KEY"
#
# Environment variables (set in .envrc.local):
#   - VELERO_BUCKET: R2 bucket name
#   - R2_ENDPOINT: https://<account-id>.r2.cloudflarestorage.com
#   - R2_ACCESS_KEY_ID: R2 API token ID
#   - R2_SECRET_ACCESS_KEY: R2 API token secret
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
  name: r2-default
  namespace: velero
spec:
  provider: aws
  default: true
  objectStorage:
    bucket: ${VELERO_BUCKET}
  credential:
    name: velero-r2-credentials
    key: cloud
  config:
    region: auto
    s3ForcePathStyle: "true"
    s3Url: ${R2_ENDPOINT}
