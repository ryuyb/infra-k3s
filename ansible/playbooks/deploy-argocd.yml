---
# Deploy ArgoCD and App of Apps
# This playbook deploys ArgoCD to the K3s cluster and sets up GitOps
#
# Prerequisites:
#   - K3s cluster is running
#   - First master node is accessible
#   - Environment variables set (R2_ACCESS_KEY_ID, R2_SECRET_ACCESS_KEY, VELERO_BUCKET, R2_ENDPOINT, CLOUDFLARE_API_TOKEN)
#
# Usage:
#   ansible-playbook ansible/playbooks/deploy-argocd.yml

- name: Deploy ArgoCD to K3s cluster
  hosts: k3s_masters[0]
  become: true
  roles:
    - argocd

- name: Setup cluster secrets
  import_playbook: setup-secrets.yml
